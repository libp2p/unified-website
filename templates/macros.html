{# Calculate relative path prefix based on current page depth #}
{# Usage: {{ macros::rel() }}css/main.css #}
{% macro rel() %}
{%- set parts = current_path | default(value="/") | split(pat="/") -%}
{%- set prefix = "" -%}
{%- for part in parts -%}
{%- if part != "" -%}
{%- set_global prefix = prefix ~ "../" -%}
{%- endif -%}
{%- endfor -%}
{{ prefix }}
{%- endmacro %}

{# Absolute URL macro for social sharing, canonical URLs, OG images #}
{% macro abs_url(path) %}
{{ config.base_url | trim_end_matches(pat="/") }}{{ path }}
{%- endmacro %}

{# Convert an absolute permalink to a relative path #}
{# Usage: {{ macros::rel_link(permalink=page.permalink) }} #}
{% macro rel_link(permalink) %}
{%- set base = config.base_url | trim_end_matches(pat="/") -%}
{%- if base != "" -%}
{%- set path = permalink | trim_start_matches(pat=base) -%}
{%- else -%}
{%- set path = permalink -%}
{%- endif -%}
{%- set path = path | trim_start_matches(pat="/") -%}
{%- set parts = current_path | default(value="/") | split(pat="/") -%}
{%- set prefix = "" -%}
{%- for part in parts -%}
{%- if part != "" -%}
{%- set_global prefix = prefix ~ "../" -%}
{%- endif -%}
{%- endfor -%}
{{ prefix }}{{ path }}
{%- endmacro %}

{# Format a number with k suffix for thousands #}
{# Usage: {{ macros::format_stars(count=21100) }} => "21.1k" #}
{% macro format_stars(count) %}
{%- if count >= 1000 -%}
{%- set thousands = count / 1000 -%}
{%- set rounded = thousands | round(precision=1) -%}
{%- if rounded == rounded | round(precision=0) -%}
{{ rounded | round(precision=0) }}k
{%- else -%}
{{ rounded }}k
{%- endif -%}
{%- else -%}
{{ count }}
{%- endif -%}
{%- endmacro %}
