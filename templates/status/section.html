{% extends "base.html" %}
{% import "macros.html" as macros %}

{% block title %}{{ section.title }}{% endblock %}

{% block body_class %}status{% endblock %}
{% block main_class %}status-layout{% endblock %}

{% block content %}
{# Sidebar Component - shown on all pages #}
{% include "components/status-sidebar.html" %}

{% if section.relative_path == "status/_index.md" %}
{# ============================================================ #}
{# Landing page: Implementation Status overview                  #}
{# ============================================================ #}
{% set data = load_data(path="static/data/status/interop-results.yml", format="yaml", required=false) %}

<div class="status-main">
    <div class="status-content">
        <article class="status-article">
            <header class="status-header">
                <h1 class="status-header__title">{{ section.title }}</h1>
                <p class="status-header__description">{{ section.description }}</p>
                <div class="status-header__updated">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                    {% if data and data["generated-at"] %}
                    Last updated: <time datetime="{{ data["generated-at"] }}">{{ data["generated-at"] | date(format="%B %d, %Y at %H:%M UTC") }}</time>
                    {% if data["workflow-run"] %}
                    <a href="{{ data["workflow-run"] }}" target="_blank" rel="noopener noreferrer" class="status-header__workflow-link">(view run)</a>
                    {% endif %}
                    {% endif %}
                </div>
            </header>

            {# Transport Interoperability Summary #}
            <section class="status-section">
                <header class="status-section__header">
                    <h2 class="status-section__title">Transport Interoperability</h2>
                    <p class="status-section__description">
                        Tests verify that different transport implementations (TCP, QUIC, WebSocket, etc.) can communicate.
                    </p>
                </header>
                {% if data and data.transport and data.transport.summary %}
                <div class="test-run-info">
                    <div class="test-run-info__stats">
                        <div class="test-run-info__item">
                            <strong>Total:</strong>
                            <span>{{ data.transport.summary.total }}</span>
                        </div>
                        <div class="test-run-info__item">
                            <strong>Passed:</strong>
                            <span class="status-text--pass">{{ data.transport.summary.passed }}</span>
                        </div>
                        <div class="test-run-info__item">
                            <strong>Failed:</strong>
                            <span class="status-text--fail">{{ data.transport.summary.failed }}</span>
                        </div>
                    </div>
                </div>
                {% endif %}
            </section>

            {# Performance Benchmark Summary #}
            <section class="status-section">
                <header class="status-section__header">
                    <h2 class="status-section__title">Performance Benchmarks</h2>
                    <p class="status-section__description">
                        Performance measurements across different libp2p implementations, measuring upload and download throughput against baseline tests: iperf, https, and quic-go. These tests run on a single host using Docker containers and a Docker network. The performance numbers are relative to each other and the baselines. This gives us a measurement of the overhead of each implementation and transport.
                    </p>
                </header>
            </section>

            {# Hole Punching Summary #}
            <section class="status-section">
                <header class="status-section__header">
                    <h2 class="status-section__title">Hole Punching</h2>
                    <p class="status-section__description">
                        Tests verifying NAT traversal capabilities across implementations using relay nodes.
                    </p>
                </header>
            </section>

            {# Attribution #}
            <section class="status-section">
                <p>
                    These results are generated automatically by the
                    <a href="https://github.com/libp2p/unified-testing" target="_blank" rel="noopener noreferrer">libp2p unified-testing</a>
                    repository. View detailed results and contribute to the test suite there.
                </p>
            </section>
        </article>
    </div>
</div>

{% else %}
{# ============================================================ #}
{# Subsection page (Transport, Performance, Hole Punch)          #}
{# ============================================================ #}

<div class="status-main">
    <div class="status-content">
        <article class="status-article">
            {# Breadcrumbs #}
            <nav class="breadcrumbs" aria-label="Breadcrumb">
                <span class="breadcrumbs__item">
                    <a href="{{ config.base_url }}/status/">Status</a>
                </span>
                <span class="breadcrumbs__separator">/</span>
                <span class="breadcrumbs__item">{{ section.title }}</span>
            </nav>

            <header class="status-header">
                <h1 class="status-header__title">{{ section.title }}</h1>
                {% if section.description %}
                <p class="status-header__description">{{ section.description }}</p>
                {% endif %}
            </header>

            {% if section.pages | length > 0 %}
            <div class="section-pages">
                <h2>In this section</h2>
                <ul class="page-list">
                    {% for page in section.pages %}
                    <li>
                        <a href="{{ macros::rel_link(permalink=page.permalink) }}">
                            <strong>{{ page.title }}</strong>
                        </a>
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% else %}
            <div class="status-section__notice">
                <p>Results are not yet available for this section.</p>
                <p>Results are generated daily by the <a href="https://github.com/libp2p/unified-testing" target="_blank" rel="noopener noreferrer">libp2p unified-testing</a> repository.</p>
            </div>
            {% endif %}
        </article>
    </div>
</div>
{% endif %}
{% endblock %}
